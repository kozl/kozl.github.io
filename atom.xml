<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Networks, security and system administration]]></title>
  <link href="http://kozl.github.io/atom.xml" rel="self"/>
  <link href="http://kozl.github.io/"/>
  <updated>2015-06-30T12:01:23+03:00</updated>
  <id>http://kozl.github.io/</id>
  <author>
    <name><![CDATA[Kozlov Alexander]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    
    <title type="html"><![CDATA[VPN]]></title>
    <link href="http://kozl.github.io/blog/2015/06/05/vpn/"/>
    
    <updated>2015-06-05T10:27:39+03:00</updated>
    <id>http://kozl.github.io/blog/2015/06/05/vpn</id>
    
    <content type="html"><![CDATA[<h3 id="ipsec">IPsec</h3>

<p><a href="ftp://ftp.isi.edu/in-notes/rfc2401.txt">RFC2401</a></p>

<p><strong>IPsec</strong> - это стандарт, включающий в себя набор протоколов, позволяющих организовать шифрование и туннелирование данных между сетевыми устройствами. Включает в себя следующие протоколы:</p>

<dl>
  <dt><strong>AH (Authentication header)</strong></dt>
  <dd>
    <p>протокол, позволяющий обеспечить целостность пакетов и аутентификацию источника</p>
  </dd>
  <dt><strong>ESP (Encapsulation Security Payload)</strong></dt>
  <dd>
    <p>занимается непосредственно шифрование данных, может обеспечивать аутентификацию источника и целостность данных. Может работать в двух режимах - транспортном и туннельном.</p>
  </dd>
  <dt><strong>IKE (Internet Key Exchange protocol)</strong></dt>
  <dd>
    <p>используется для аутентификации узлов-участников VPN и защищенного согласование SA (Security Association)</p>
  </dd>
</dl>

<p>IPsec оперирует следующими понятиями:</p>

<dl>
  <dt><strong>SA (Security Association)</strong></dt>
  <dd>
    <p>набор параметров защищенного соединения (например протокол, ключ шифрования), у каждого соединения есть свой SA. SA определяется для соединения в одном направлении. Каждый SA идентифицируется SPI (Security Parameter Index), указанным в каждом пакете в заголовке IPsec.</p>
  </dd>
  <dt><strong>SPD (Security Policy Database)</strong></dt>
  <dd>
    <p>набор политик, определяющих какие данные будут шифроваться и какие SA при этом должны быть выбраны.</p>
  </dd>
</dl>

<p>IPsec может функционировать в двух режимах: транспортном и туннельном</p>

<dl>
  <dt><strong>Транспортный режим</strong></dt>
  <dd>
    <p>оставляет IP заголовок неизменным, шифрует содержимое пакета. Используется, как правило, для защиты данных между хостами. Может использоваться между шлюзами для защиты данных в тоннеле, организованным другими средствами, например GRE или L2TP.</p>
  </dd>
  <dt><strong>Туннельный режим</strong></dt>
  <dd>
    <p>в этом режиме исходный пакет шифруется полностью и инкапсулируется в новый пакет. Используется для организации Site-to-site VPN.</p>
  </dd>
</dl>

<h3 id="section">Дополнительные материалы</h3>

<p><a href="http://lartc.org/howto/lartc.ipsec.html">IPsec в Linux</a></p>

]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[CCNA: конспект]]></title>
    <link href="http://kozl.github.io/blog/2015/06/01/ccna-konspiekt/"/>
    
    <updated>2015-06-01T11:37:56+03:00</updated>
    <id>http://kozl.github.io/blog/2015/06/01/ccna-konspiekt</id>
    
    <content type="html"><![CDATA[<h2 id="ccna-version-2-200-120">CCNA Version 2 (200-120)</h2>

<ul>
  <li><a href="#operation-of-ip-data-networks">1.0 Operation of IP Data Networks</a>
    <ul>
      <li><a href="#describe-the-purpose-and-basic-operation-of-the-protocols-in-the-osi-and-tcpip-models">1.4 Describe the purpose and basic operation of the protocols in the OSI and TCP/IP models</a></li>
      <li><a href="#identify-the-appropriate-media-cables-ports-and-connectors-to-connect-cisco-network-devices-to-other-network-devices-and-hosts-in-a-lan">1.6 Identify the appropriate media, cables, ports and connectors to connect Cisco network devices to other network devices and hosts in a LAN</a></li>
    </ul>
  </li>
  <li><a href="#lan-switching-technologies">2.0 LAN Switching Technologies</a>
    <ul>
      <li><a href="#configure-and-verify-initial-switch-configuration-including-remote-access-management">2.3 Configure and verify initial switch configuration including remote access management</a></li>
      <li><a href="#configure-and-verify-vlans">2.6 Configure and verify VLANs</a></li>
      <li><a href="#configure-and-verify-trunking-on-cisco-switches">2.7 Configure and verify trunking on Cisco switches</a></li>
      <li><a href="#identify-enhanced-switching-technologies">2.8 Identify enhanced switching technologies</a></li>
    </ul>
  </li>
  <li><a href="#ip-addressing-ipv4ipv6">3.0 IP Addressing (IPv4/IPv6)</a>
    <ul>
      <li><a href="#describe-ipv6-addresses">3.5 Describe IPv6 addresses</a></li>
    </ul>
  </li>
  <li><a href="#ip-routing-technologies">4.0 IP Routing Technologies</a>
    <ul>
      <li><a href="#describe-basic-routing-concepts">4.1 Describe basic routing concepts</a></li>
      <li><a href="#configure-and-verify-ospf">4.7 Configure and verify OSPF</a></li>
      <li><a href="#configure-and-verify-intervlan-routing-router-on-a-stick">4.8 Configure and verify interVLAN routing (Router on a stick)</a></li>
      <li><a href="#configure-svi-interfaces">4.9 Configure SVI interfaces</a></li>
      <li><a href="#manage-cisco-ios-files">4.10 Manage Cisco IOS Files</a></li>
      <li><a href="#configure-and-verify-eigrp-single-as">4.11 Configure and verify EIGRP (single AS)</a></li>
    </ul>
  </li>
  <li><a href="#ip-services">5.0 IP Services</a>
    <ul>
      <li><a href="#configure-and-verify-dhcp-ios-router">5.1 Configure and verify DHCP (IOS Router)</a></li>
      <li><a href="#configure-and-verify-acls-in-a-network-enviroment">5.3 Configure and verify ACLs in a network enviroment</a></li>
      <li><a href="#identify-the-basic-operation-of-nat">5.4 Identify the basic operation of NAT</a></li>
      <li><a href="#configure-and-verify-ntp-as-a-client">5.6 Configure and verify NTP as a client</a></li>
    </ul>
  </li>
  <li><a href="#network-device-security">6.0 Network device security</a>
    <ul>
      <li><a href="#configure-and-verify-switch-port-security">6.2 Configure and verify Switch Port Security</a></li>
    </ul>
  </li>
</ul>

<h3 id="operation-of-ip-data-networks">1.0 Operation of IP Data Networks</h3>

<h4 id="describe-the-purpose-and-basic-operation-of-the-protocols-in-the-osi-and-tcpip-models">1.4 Describe the purpose and basic operation of the protocols in the OSI and TCP/IP models</h4>

<p><strong>OSI</strong></p>

<table class="table">
  <thead>
    <tr>
      <th>Layer</th>
      <th>Name</th>
      <th>Protocols</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>7</td>
      <td>Application</td>
      <td>DNS, NTP, FTP, HTTP, DHCP, SMTP, Telnet, NFS</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Presentation</td>
      <td>MIME, SSL/TLS</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Session</td>
      <td>NETBIOS, RPC, SOCKS</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Transport</td>
      <td>TCP, UDP, SCTP</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Network</td>
      <td>IP, ICMP, IGMP, IPsec, OSPF, RIP, EIGRP, IS-IS</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Data link</td>
      <td>L2TP, PPP, Ethernet, CDP, HDLC, ARP, Frame Relay</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Physical</td>
      <td>DSL, USB</td>
    </tr>
  </tbody>
</table>

<p>.</p>

<p><strong>DoD</strong></p>

<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Protocols</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Application</td>
      <td>DNS, NTP, FTP, HTTP, DHCP, SMTP, Telnet, NFS</td>
    </tr>
    <tr>
      <td>Transport layer</td>
      <td>TCP, UDP, SCTP</td>
    </tr>
    <tr>
      <td>Internet layer</td>
      <td>IP, ICMP, IGMP, IPsec, OSPF, RIP, EIGRP, IS-IS</td>
    </tr>
    <tr>
      <td>Link layer</td>
      <td>L2TP, PPP, Ethernet, CDP, HDLC, ARP, Frame Relay</td>
    </tr>
  </tbody>
</table>

<p>.</p>

<h4 id="identify-the-appropriate-media-cables-ports-and-connectors-to-connect-cisco-network-devices-to-other-network-devices-and-hosts-in-a-lan">1.6 Identify the appropriate media, cables, ports and connectors to connect Cisco network devices to other network devices and hosts in a LAN</h4>

<p>Схемы распайки: TIA <strong>T568A</strong>, и EIA <strong>T568B</strong></p>

<p><img src="http://www.bitsbyjohn.com/wp-content/uploads/2013/06/UTP-Pairing.png" /></p>

<table class="table">
  <thead>
    <tr>
      <th>TX: 1,2 RX: 3,6</th>
      <th>RX: 1,2 TX: 3,6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Сетевые адаптеры ПК</td>
      <td>Коммутаторы</td>
    </tr>
    <tr>
      <td>Маршрутизаторы</td>
      <td> </td>
    </tr>
    <tr>
      <td>Точки доступа</td>
      <td> </td>
    </tr>
    <tr>
      <td>Сетевые принтеры</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Однотипные устройства подключаются перекрещенным кабелем (crossover)</p>

<p>Cisco Console Rollover cable</p>

<p><img src="http://wiki.artisansasylum.com/images/b/b6/Wiring-rollover.png" /></p>

<h3 id="lan-switching-technologies">2.0 LAN Switching Technologies</h3>

<h4 id="configure-and-verify-initial-switch-configuration-including-remote-access-management">2.3 Configure and verify initial switch configuration including remote access management</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">hostname &lt;HOSTNAME&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">interface Vlan &lt;NUM&gt;
</span><span class="line"> no sh
</span><span class="line"> ip address &lt;IP&gt; &lt;MASK&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">ip default-gateway &lt;GW&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">username &lt;USER&gt; password &lt;PASSWORD&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">line vty 0 15
</span><span class="line"> login local
</span><span class="line"> transport input &lt;PROTOCOL&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">enable secret &lt;PASSWORD&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">service password-encryption</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-and-verify-vlans">2.6 Configure and verify VLANs</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class=""><span class="line">vlan &lt;NUM&gt;
</span><span class="line"> name &lt;NAME&gt;
</span><span class="line">
</span><span class="line">interface &lt;INT&gt;
</span><span class="line"> switchport access vlan &lt;VLAN&gt;
</span><span class="line">
</span><span class="line">interface &lt;INT&gt;
</span><span class="line"> switchport trunk encapsulation dot1q
</span><span class="line"> switchport trunk allowed vlan &lt;VLANS&gt;
</span><span class="line"> switchport trunk native vlan &lt;VLAN&gt;
</span><span class="line"> switchport mode trunk</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-and-verify-trunking-on-cisco-switches">2.7 Configure and verify trunking on Cisco switches</h4>

<table class="table">
  <thead>
    <tr>
      <th>switchport modes</th>
      <th>trunk active</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>access</td>
      <td>-</td>
    </tr>
    <tr>
      <td>trunk</td>
      <td>trunk, dynamic auto, dynamic desirable</td>
    </tr>
    <tr>
      <td>dynamic auto</td>
      <td>trunk, dynamic desirable</td>
    </tr>
    <tr>
      <td>dynamic desirable</td>
      <td>trunk, dynamic auto, dynamic desirable</td>
    </tr>
    <tr>
      <td>nonegotiate</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<h4 id="identify-enhanced-switching-technologies">2.8 Identify enhanced switching technologies</h4>

<p><strong>STP</strong> - 802.1d</p>

<ol>
  <li>Выбирается корневой мост. Корневым становится коммутатор с меньшим Bridge ID = Priority + MAC. Приоритет может быть изменен администратором с целью влияния на процесс выбора</li>
  <li>Определение корневых и выделенных портов (root и designated ports). Корневой выбирается по наилучшему пути до корневого моста. Наименьший по Root Path Cost.</li>
  <li>Перевод остальных портов в состояние Blocking</li>
</ol>

<p>Роли портов:</p>

<ol>
  <li>Root port</li>
  <li>Designated port</li>
  <li>Non-designated port</li>
  <li>Disabled port</li>
</ol>

<p>Состояния портов:</p>

<ol>
  <li>Blocking</li>
  <li>Listening</li>
  <li>Learning</li>
  <li>Forwarding</li>
</ol>

<p><strong>RSTP</strong> - 802.1w, ускоренная сходимость за счёт наличия альтернативных путей до корневого моста и меньшего количества состояний порта</p>

<p>Роли портов:</p>

<ol>
  <li>Root port</li>
  <li>Designated port</li>
  <li>Alternative port</li>
  <li>Backup port</li>
</ol>

<p>Состояния портов:</p>

<ol>
  <li>Discarding</li>
  <li>Learning</li>
  <li>Forwarding</li>
</ol>

<p><strong>PVST</strong>, <strong>PVST+</strong> - проприетарные протоколы Cisco, для каждого VLAN строят отдельное дерево, могут использовать транки на ISL. Основаны на STP.</p>

<dl>
  <dt><strong>Rapid PVST</strong>, <strong>Rapid PVST+</strong> - основаны на RSTP</dt>
  <dt><strong>Portfast</strong></dt>
  <dd>настраивается на access портах, сразу переводит порт в состояние Forwarding
<strong>BPDU Guard</strong></dd>
  <dd>выключает порт при получении BPDU</dd>
</dl>

<p><strong>MSTP</strong> - 802.1s</p>

<p><strong>Etherchannel</strong></p>

<p>Существует три варианта конфигурирования аггрегированного канала:</p>

<ol>
  <li>Статическая настройка</li>
  <li>Настройка при помощи протокола LACP - стандартный протокол</li>
  <li>Настройка при помощи протокола PagP - проприетарный протокол</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">interface range fa0/10 - 13
</span><span class="line"> channel-group 3 mode on</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Режимы (modes):</p>

<ol>
  <li><em>on</em> - статическая настройка</li>
  <li><em>active</em> - включить LACP</li>
  <li><em>passive</em> - включить LACP при получении сообщения LACP</li>
  <li><em>desirable</em> - включить PagP</li>
  <li><em>auto</em> - включить PagP при получении сообщения PagP</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show etherchannel summary</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show etherchannel port-channel</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Основная проблема - балансировка нагрузки. Вовсе не факт, что все каналы в аггрегированном канале будут загружены равномерно. Это определяется политикой балансировки по каналам. Она может быть:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sw1(config)# port-channel load-balance ?
</span><span class="line">  dst-ip       Dst IP Addr
</span><span class="line">  dst-mac      Dst Mac Addr
</span><span class="line">  src-dst-ip   Src XOR Dst IP Addr
</span><span class="line">  src-dst-mac  Src XOR Dst Mac Addr
</span><span class="line">  src-ip       Src IP Addr
</span><span class="line">  src-mac      Src Mac Addr</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>PVST configuration</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">spanning-tree mode rapid-pvst
</span><span class="line">spanning-tree vlan &lt;VLANS&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Настройка Portfast</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sw(config)#interface fa0/1
</span><span class="line">sw(config-if)# spanning-tree portfast</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Настройка Bridge priority</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">spanning-tree vlan vlan-id root primary
</span><span class="line">spanning-tree vlan vlan-id root secondary
</span><span class="line">spanning-tree vlan &lt;VLAN&gt; priority &lt;PRI&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Настройка стоимости портов</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">sw(config-if)# spanning-tree cost &lt;COST&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show spanning tree
</span><span class="line">show spanning tree detail</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="ip-addressing-ipv4ipv6">3.0 IP Addressing (IPv4/IPv6)</h3>

<h4 id="describe-ipv6-addresses">3.5 Describe IPv6 addresses</h4>

<p>IPv6</p>

<ul>
  <li>большее адресное пространство</li>
  <li>большая эффективность маршрутизации</li>
  <li>автоконфигурация</li>
  <li>IPsec</li>
  <li>нет броадкастов</li>
  <li>нет контрольных сумм заголовков</li>
  <li>в заголовок добавлен Flow Label</li>
</ul>

<p>Формат представления: x:x:x:x:x:x:x:x, где x - шестнадцатеричное число</p>

<ul>
  <li>нули слева записывать необязательно</li>
  <li>последовательность 0 может быть заменена :: (но только один раз)</li>
  <li>48-bit global prefix, 16-bit subnet ID and 64-bit interface ID</li>
</ul>

<p>Виды адресов:</p>

<ul>
  <li>Unicast (one-to-one)</li>
  <li>global: 2000::/3</li>
  <li>link-local: FE80::/10</li>
  <li>loopback: ::1</li>
  <li>reserved</li>
  <li>Multicast (one-to-many)</li>
  <li>Anycast (one-to-nearest)</li>
</ul>

<p>Global Unicast адреса:</p>

<ul>
  <li>на каждый интерфейс может быть назначено несколько адресов любого типа</li>
  <li>каждый интерфейс имеет по меньшей мере один loopback и один link-local адрес</li>
</ul>

<p>Назначение IPv6 адреса:</p>

<ul>
  <li>статическое, указываем полный адрес</li>
  <li>статическое, указываем сеть, младшие 64 бита генерирует EUI-64 как функцию от MAC интерфейса</li>
  <li>автоконфигурация</li>
  <li>DHCPv6</li>
</ul>

<p><strong>EUI-64</strong></p>

<p>Метод генерации младших 64 бит адреса, используется MAC адрес, между старшими и младшими 3 байтами которого вставляется последовательность FF FE</p>

<p><strong>Переход от IPv4 к IPv6</strong></p>

<ul>
  <li>Dual stack</li>
  <li>6to4 tunneling</li>
  <li>ISATAP</li>
  <li>Teredo</li>
</ul>

<h3 id="ip-routing-technologies">4.0 IP Routing Technologies</h3>

<h4 id="describe-basic-routing-concepts">4.1 Describe basic routing concepts</h4>

<p><strong>Process Switching</strong> - решение о маршрутизации и проверка RIB осуществляется ЦП для каждого пакета в отдельности
<strong>Fast Switching</strong> - ЦП задействуется для принятия решения о первом пакете в потоке, далее эта информация кешируется и остальные пакеты маршрутизируются на основе данных в кеше.
<strong>CEF</strong> - строится FIB и Adjacency table, в которых хранятся заранее рассчитанные данные, необходимые для машрутизации (интерфейс, MAC адрес следующего узла, IP адрес и т.п.). Эти таблицы хранятся в быстрой памяти, поиск по которой занимает намного меньше времени и может быть реализован аппаратно.</p>

<h4 id="configure-and-verify-ospf">4.7 Configure and verify OSPF</h4>

<p>Перимущества OSPF с одной зоной: роутеры одной зоны имеют полную информацию о топологии этой зоны, используются наиболее оптимальные маршруты.</p>

<p>Недостатки: при кол-ве роутеров более 50 (в некоторых источниках более 25-30) требования к памяти и вычислительным ресурсам каждого маршрутизатора возрастают и рекомендуется использовать несколько зон. Кроме этого это позволит осуществлять автосуммирование на ABR.</p>

<p><strong>Конфигурирование OSPFv2</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router ospf &lt;PID&gt;
</span><span class="line">router-id &lt;ROUTER ID&gt;
</span><span class="line">network &lt;A.B.C.D&gt; &lt;REVERSE MASK&gt; area &lt;AREA&gt;
</span><span class="line">(-if) ip ospf &lt;PID&gt; area &lt;AREA&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show ip protocol
</span><span class="line">show ip ospf
</span><span class="line">show ip ospf neighbor
</span><span class="line">show ip ospf interface
</span><span class="line">show ip ospf database</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Конфигурирование OSPFv3</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router ospfv3 &lt;PID&gt;
</span><span class="line">router-id &lt;ROUTER ID&gt;
</span><span class="line">(-if) ipv6 router ospfv3 &lt;PID&gt; area &lt;AREA&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Passive interface</strong> - не рассылает OSPF пакеты, но этот интерфейс анонсируется в LSA</p>

<p><strong>типы LSA</strong></p>

<table class="table">
  <thead>
    <tr>
      <th>Номер LSA</th>
      <th>Название LSA</th>
      <th>Кто отправляет</th>
      <th>Область распространения</th>
      <th>Назначение</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>LSA 1</td>
      <td>Router LSA</td>
      <td>Каждый маршрутизатор</td>
      <td>Внутри зоны</td>
      <td>Описывает маршрутизатор, все имеющиеся у него интерфейсы, их стоимость и соседей на каждом интерфейсе</td>
    </tr>
    <tr>
      <td>LSA 2</td>
      <td>Network LSA</td>
      <td>DR (в сетях со множественным доступом)</td>
      <td>Внутри зоны</td>
      <td>Описывает широковещательную сеть, указаны все маршрутизаторы, подключённые к ней, DR, маска сети</td>
    </tr>
    <tr>
      <td>LSA 3</td>
      <td>Network Summary LSA</td>
      <td>ABR</td>
      <td>AS</td>
      <td>Содержит информацию о сетях вне зоны и их стоимость. Не содержит информации о топологии сети. Сети могут быть просуммированы.</td>
    </tr>
    <tr>
      <td>LSA 4</td>
      <td>ASBR Summary LSA</td>
      <td>ABR</td>
      <td>AS</td>
      <td>Необходим для того чтобы сообщить всем маршрутизатором о том, где находится ASBR, содержит суммарную информацию о состоянии каналов ASBR.</td>
    </tr>
    <tr>
      <td>LSA 5</td>
      <td>AS External LSA</td>
      <td>ASBR</td>
      <td>AS</td>
      <td>Объявление о состоянии внешних по отношению к AS каналов</td>
    </tr>
    <tr>
      <td>LSA 7</td>
      <td>AS External LSA for NSSA</td>
      <td>ASBR</td>
      <td>NSSA area</td>
      <td>Аналогично LSA 5, но может распространяться только в NSSA зоне.</td>
    </tr>
  </tbody>
</table>

<h4 id="configure-and-verify-intervlan-routing-router-on-a-stick">4.8 Configure and verify interVLAN routing (Router on a stick)</h4>

<p>Настройка сабинтерфейса на 101 влане, на маршрутизаторе:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">interface fa1/0.101
</span><span class="line"> encapsulation dot1Q 101
</span><span class="line"> ip address 192.168.101.1 255.255.255.0</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-svi-interfaces">4.9 Configure SVI interfaces</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">interface vlan 101
</span><span class="line"> no shutdown
</span><span class="line"> ip address 192.168.101.254 255.255.255.0</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="manage-cisco-ios-files">4.10 Manage Cisco IOS Files</h4>

<p><strong>Типы памяти</strong></p>

<ul>
  <li><strong>ROM</strong> - ПЗУ, хранит код bootstrap программы - ROMmon и POST</li>
  <li><strong>Flash</strong> - перезаписываемая, в ней хранится образ IOS</li>
  <li><strong>NVRAM</strong> - перезаписываемая, в ней хранятся конфиги</li>
  <li><strong>ROM</strong> - оперативная память</li>
</ul>

<p><strong>Последовательность загрузки</strong></p>

<ul>
  <li>включается питание</li>
  <li>запускается bootstrap программа из ROM, которая запускает POST</li>
  <li>проверяется регистр confreg и определяется место, откуда будет загружаться образ IOS. По умолчанию (значение 2102), проверяется startup-config на наличие указаний откуда нужно грузить образ, если они отсутствуют, образ грузится из Flash памяти. Если образ отсутствует во Flash памяти, bootstrap пытается загрузить образ с TFTP сервера.</li>
  <li>образ загружается в RAM</li>
  <li>если startup-config отсутствует, запускается мастер конфигурации setup</li>
</ul>

<p><strong>Установка/удаление лицензий</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show license all
</span><span class="line">license install &lt;URI&gt;
</span><span class="line">license clear &lt;URI&gt;
</span><span class="line">license save &lt;URI&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-and-verify-eigrp-single-as">4.11 Configure and verify EIGRP (single AS)</h4>

<p><strong>Feasible Distance</strong> - Administrative distance + стоимость пути до маршрутизатора, анонсировавшего этот маршрут</p>

<p><strong>Feasible Successors</strong> - резервные маршруты до сети назначения</p>

<p><strong>Feasibility condition</strong> - условие, при котором маршрут становится FS, его AD должна быть меньше FD текцщего Successor’a</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show eigrp topology
</span><span class="line">show eigrp topology all-links</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Administrative distance</strong> - приоритет маршрутов, полученных от данного протокола маршрутизации, чем он меньше, тем лучшим считается маршрут.У EIGRP AD=90</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router eigrp 65001
</span><span class="line"> distance eigrp 60 120</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Metric composition</strong> - принцип расчёта метрики, по которым выбирается наилучший маршрут. Для расчёта метрики IEGRP использует 5 параметров, которые позволяют выбрать вес для следующих характеристик каналов: пропускная способность, задержка, надежность, загрузка канала. По умолчанию метрика пропорциональна сумме пропускной способности и задержки. Bandwith маршрута равна наименьшей bandwith составляющих его каналов.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router eigrp 65001
</span><span class="line"> metric weights 0 1 0 1 0 0</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Router ID</strong> - уникальный в пределах AS идентификатор маршрутазатора</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router eigrp 65001
</span><span class="line"> eigrp router-id 1.1.1.1</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Auto summary</strong> - автосуммирование анонсированных маршрутов до классовых сетей</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router eigrp 65001
</span><span class="line"> no auto-summary</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Path selection</strong> - наилучшим считается маршрут с наименьшей композитной метрикой.</p>

<p><strong>Load balancing</strong> - нагрузка балансируется для маршрутов с одинаковой метрикой. Возможна балансировка по маршрутам с разной метрикой между Successor и Fesible successor, если настроить variance, множителя, на который умножается FD лучшего маршрута для определения feasible маршрутов, по которым будет балансироваться нагрузка.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">router eigrp 65001
</span><span class="line"> maximum-paths 6
</span><span class="line"> variance 2</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="ip-services">5.0 IP Services</h3>

<h4 id="configure-and-verify-dhcp-ios-router">5.1 Configure and verify DHCP (IOS Router)</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">service dhcp
</span><span class="line">ip dhcp excluded-address
</span><span class="line">ip dhcp pool &lt;POOL NAME&gt;
</span><span class="line"> network &lt;NETWORK&gt; &lt;MASK&gt;
</span><span class="line"> domain-name &lt;DOMAIN&gt;
</span><span class="line"> dns-server &lt;DNS&gt;
</span><span class="line"> default-router &lt;GW&gt;
</span><span class="line"> lease &lt;LEASE&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-and-verify-acls-in-a-network-enviroment">5.3 Configure and verify ACLs in a network enviroment</h4>

<p><strong>Именованый</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">R1(conf)# ip access-list standard &lt;NAME&gt;
</span><span class="line">R1(conf-std-nacl)# deny 10.0.0.0 0.0.0.255</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Нумерованный</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">R1(conf)# access-list &lt;1-99&gt; deny 10.0.0.0 0.0.0.255</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Применение ACL на интерфейсе</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">R1(conf-if)# ip access-group &lt;1-99&gt; &lt;in | out&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Применение ACL на vty</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">R1(config-line)# access-class &lt;1-99&gt; &lt;in | out&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="identify-the-basic-operation-of-nat">5.4 Identify the basic operation of NAT</h4>

<p><strong>Static NAT</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">R1(config-if)# ip nat inside
</span><span class="line">...
</span><span class="line">R1(config-if)# ip nat outside
</span><span class="line">R1(config)# ip nat inside static 172.16.50.8 172.16.10.8</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Dynamic NAT</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">...
</span><span class="line">access list 100 permit 10.0.0.0 0.0.0.255 any
</span><span class="line">ip nat pool MYPOOL 11.1.1.0 11.1.1.20 netmask 255.255.255.0
</span><span class="line">ip nat inside source  list 100 pool MYPOOL </span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>PAT (NAT overload)</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">...
</span><span class="line">ip nat inside source  list 100 pool MYPOOL overload</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show ip nat translations</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="configure-and-verify-ntp-as-a-client">5.6 Configure and verify NTP as a client</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">ntp server 7.7.7.7</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">show clock detail
</span><span class="line">show ntp associations</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="network-device-security">6.0 Network device security</h3>

<h4 id="configure-and-verify-switch-port-security">6.2 Configure and verify Switch Port Security</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">switch(config-if)# switchport port-security mac-address sticky</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">switch(config-if)# switchport port-security maximum 10</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">switch(config-if)# switchport port-security violation &lt;protect | restrict | shutdown&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>protect</strong> - отбрасывать небезопасные кадры, не увеличивая при этом счетчик security violation
<strong>restrict</strong> - то же самое с увеличением счётчика
<strong>shutdown</strong> - отключать порт, переходит в состояние err-disable</p>

<p>Автоматическое восстановление из состояния err-disable:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">errdisable recovery interval &lt;SECONDS&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Двухточечные протоколы]]></title>
    <link href="http://kozl.github.io/blog/2015/05/22/dvukhtochiechnyie-protokoly/"/>
    
    <updated>2015-05-22T16:00:42+03:00</updated>
    <id>http://kozl.github.io/blog/2015/05/22/dvukhtochiechnyie-protokoly</id>
    
    <content type="html"><![CDATA[<h2 id="point-to-point-protocol-ppp">Point-to-Point Protocol (PPP)</h2>

<p>Двухточечный протокол канального уровня. Обеспечивает:</p>

<ul>
  <li>аутентификацию (PAP и CHAP)</li>
  <li>автоматическую настройку интерфейсов на каждом конце по протоколу LCP</li>
  <li>обнаружение закольцованных связей (на физическом уровне)</li>
  <li>возможность работы нескольких протоколов 3 уровня на одном канале связи</li>
  <li>обнаружение ошибок</li>
  <li>многоканальную передачу, для передачи трафика через несколько физических каналов имея одно логическое соединение</li>
</ul>

<p><strong>LCP</strong> - Link Control Protocol, для установление соединения и согласования параметров соединения</p>

<p><strong>NCP</strong> - Network Control Protocol, инициирует соединение и настройку различных протоколов сетевого уровня. Для IP - IPCP</p>

<h4 id="section">Аутентификация</h4>

<p><strong>PAP</strong> - пароль передаётся в открытом тексте
<strong>CHAP</strong> - challenge-response аутентификация, основанная на MD5</p>

<p>Конфигурация на маршрутизаторах Cisco:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">hostname R1
</span><span class="line">username R2 password mypass
</span><span class="line">!
</span><span class="line">interface serial 0/1
</span><span class="line"> encapsulation ppp
</span><span class="line"> ppp authentication chap</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[EIGRP: краткий конспект]]></title>
    <link href="http://kozl.github.io/blog/2015/05/19/eigrp-kratkii-konspiekt/"/>
    
    <updated>2015-05-19T12:38:41+03:00</updated>
    <id>http://kozl.github.io/blog/2015/05/19/eigrp-kratkii-konspiekt</id>
    
    <content type="html"><![CDATA[<ul>
  <li>Advanced distance-vector routing protocol</li>
  <li>Обнаруживает соседей путём отправки Hello пакетов мультикастом, хранит информацию о них</li>
  <li>Надежная доставка через уведомления о получении сообщения, отправляет сначала мультикастом, если не получил ответ - юникастом</li>
  <li>Рассылает не полную таблицу маршрутов как RIP, а только обновления</li>
  <li>Метрики, основанные на полосе пропускания, задержке, надежности, нагрузке. MTU учитывается, но не участвует в расчёте метрики.</li>
  <li>Расчёт метрики: bandwith маршрута = минимальной bandwith на маршруте, из-за этого расчитывает маршруты точнее, чем OSPF</li>
  <li>Маршрутизаторы хранят все маршруты до искомой сети, выбирается основной (Successor Route), который добавляется в таблицу маршрутизации и резервный (Feasible Route), который будет задействован в случае выхода из строя основного</li>
  <li>Суммирование возможно на любом маршрутизаторе</li>
</ul>

<h2 id="eigrp">Терминология EIGRP</h2>

<ul>
  <li><strong>DUAL</strong> - Diffusing Update ALgorithm, алгоритм, который используется для вычисления новых маршрутов.
    <ul>
      <li><strong>AD</strong> - Advertised Distance, стоимость расстояния между соседом и целевой подсетью</li>
      <li><strong>FD</strong> - Feasible Distance, AD + стоимость расстояния между локальным маршрутизатором и соседом</li>
      <li><strong>Successor</strong> - маршрут до целевой подсети с наименьшей стоимостью</li>
      <li><strong>Feasible</strong> - резервный маршрут, такой, у которого FD меньше чем AD successor’a</li>
    </ul>
  </li>
</ul>

<h4 id="section">Типы пакетов</h4>

<ul>
  <li><strong>Hello</strong> - для обнаружения соседей, единственный пакет, который не подтверждается</li>
  <li><strong>Update</strong> - для обмена маршрутной информацией, основная работа</li>
  <li><strong>Query</strong> - запрос маршрутной информацией к соседям</li>
  <li><strong>Reply</strong> - ответ на запрос</li>
  <li><strong>Ack</strong> - подтверждение</li>
</ul>

<h2 id="section-1">Стадии установления соседства</h2>

<ol>
  <li><strong>R1</strong> и <strong>R2</strong> отправляют Hello мультикастом</li>
  <li>Получив Hello маршрутизатор вносит отправителя в список своих соседей</li>
  <li>После установления соседства, роутер с большим IP первым отправляет Update, следом за ним второй, все они подтверждаются.</li>
</ol>

<h4 id="section-2">Формула расчёта метрики</h4>

<script type="math/tex; mode=display">\begin{equation}
\mbox{} (Metric = K_1*BW+(\frac{K_2*BW}{256 - Load})+K_3*Delay)*(\frac{K_5}{Reliability+K_4}) \\
\mbox{} BW = (10000000/bandwith(i))*256 \\
\mbox{} Delay = (delay(i))*256 \\
\end{equation}</script>

<p><em>bandwith(i)</em> - минимальное значение bandwith на всём маршруте, в килобитах
<em>delay(i)</em> - суммарная задержка на маршруте, измеряется в десятках  микросекунд
<em>Load</em> - худшая загрузка на маршруте, измеряется от 1 до 255
<em>Reliability</em> - худшее значение надежности на всём маршруте</p>

<p>По умолчанию: 
<script type="math/tex">\begin{align}
\mbox{} K_1=K_3=1, K_2=K_4=K5=0
\end{align}</script>
При таких параметрах формула превращается в такую:</p>

<script type="math/tex; mode=display">\begin{align}
\mbox{} Metric = BW + Delay
\end{align}</script>

<h2 id="section-3">Балансировка нагрузки</h2>

<p>Возможна балансировка по маршрутам с различной метрикой, настраивается параметром variance. Маршруты до подсети считаются эквивалентыми, если FD лучшего маршрута * variance &lt; FD другого маршрута. Маршруты, у которых AD &gt; чем FD лучшего маршрута не участвуют в определении эквивалентных маршрутов - такой механизм нужен для защиты от петель.</p>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Базовая настройка маршрутизатора]]></title>
    <link href="http://kozl.github.io/blog/2015/05/18/bazovaia-nastroika-marshrutizatora/"/>
    
    <updated>2015-05-18T17:11:57+03:00</updated>
    <id>http://kozl.github.io/blog/2015/05/18/bazovaia-nastroika-marshrutizatora</id>
    
    <content type="html"><![CDATA[<p>Удаление предыдущей конфигурации</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Router#erase startup-config</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Отключение DNS запросов при ошибках в консоли</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">no ip domain lookup</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Выключить таймаут неактивной сессии в консоли, привилегированный режим в консоли, включить синхронный вывод на консоль:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">line con 0
</span><span class="line"> exec-timeout 0 0
</span><span class="line"> privilege level 15
</span><span class="line"> logging synchronous</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Хранить startup конфиг в сжатом виде</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">service compress-config </span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section">Безопасность</h3>

<p>Хранение паролей в зашифрованном виде</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">service password-encryption</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Блокировать после нескольких неудачных попыток залогиниться</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">login block-for &lt;timeout&gt; attemts &lt;num&gt; within &lt;timeot&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Логирование доступа</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">login on-success log
</span><span class="line">login on-failure log every 2</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Настройка ключей SSH</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class=""><span class="line">hostname &lt;hostname&gt;
</span><span class="line">ip domain name &lt;domain name&gt;
</span><span class="line">crypto key generate rsa general-keys modulus 1024
</span><span class="line">ip ssh time-out 90
</span><span class="line">ip ssh maxstartups 2 
</span><span class="line">ip ssh authentication-retries 2 </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Настроить SSH на нестандартный порт</p>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">ip ssh port &lt;port&gt; rotary &lt;group&gt;
</span><span class="line">line vty 0 4
</span><span class="line"> rotary &lt;group&gt;</span></code></pre></td></tr></table></div></figure></notextile></div>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[Зарезервированные IP адреса: RFC 6890]]></title>
    <link href="http://kozl.github.io/blog/2015/05/18/zarieziervirovannyie-ip-adriesa-rfc-6890/"/>
    
    <updated>2015-05-18T15:57:17+03:00</updated>
    <id>http://kozl.github.io/blog/2015/05/18/zarieziervirovannyie-ip-adriesa-rfc-6890</id>
    
    <content type="html"><![CDATA[<table class="table">
  <thead>
    <tr>
      <th style="text-align: center">Подсеть</th>
      <th>Назначение</th>
      <th>Маршрутизация</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">0.0.0.0/8</td>
      <td>Адреса источников “своей” сети</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">0.0.0.0/32</td>
      <td>Любая сеть отправителя или получателя</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">10.0.0.0/8</td>
      <td>Для использования в частных сетях</td>
      <td>только в частных сетях</td>
    </tr>
    <tr>
      <td style="text-align: center">100.64.0.0/10</td>
      <td>Shared Address Space. RFC 6598. Для использования в сетях сервис-провайдера.</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">127.0.0.0/8</td>
      <td>Loopback IP</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">169.254.0.0/16</td>
      <td>Автоматическое назначение IP адреса</td>
      <td>только в частных сетях</td>
    </tr>
    <tr>
      <td style="text-align: center">172.16.0.0/12</td>
      <td>Для использования в частных сетях</td>
      <td>только в частных сетях</td>
    </tr>
    <tr>
      <td style="text-align: center">192.0.2.0/24</td>
      <td>Для примеров в документации.</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">192.88.99.0/24</td>
      <td>Используются для рассылки ближайшему узлу. RFC 3068</td>
      <td>глобально запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">192.88.99.1/32</td>
      <td>Применяется в качестве ретранслятора при инкапсуляции IPv6 в IPv4</td>
      <td>глобально запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.0.0/16</td>
      <td>Для использования в частных сетях.</td>
      <td>только в частных сетях</td>
    </tr>
    <tr>
      <td style="text-align: center">198.51.100.0/24</td>
      <td>Для примеров в документации.</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">198.18.0.0/15</td>
      <td>Для стендов тестирования производительности.</td>
      <td>только для тестов</td>
    </tr>
    <tr>
      <td style="text-align: center">203.0.113.0/24</td>
      <td>Для примеров в документации.</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">224.0.0.0/4</td>
      <td>Multicast IP</td>
      <td>Глобально разрешена только для подсетей 233.0.0.0/8 и 234.0.0.0/8.</td>
    </tr>
    <tr>
      <td style="text-align: center">239.0.0.0/8</td>
      <td>Для частных мультикаст-доменов/организаций</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">240.0.0.0/4</td>
      <td>Зарезервировано для использования в будущем.</td>
      <td>запрещена</td>
    </tr>
    <tr>
      <td style="text-align: center">255.255.255.255/32</td>
      <td>Широковещательный адрес</td>
      <td>запрещена</td>
    </tr>
  </tbody>
</table>
]]></content>
    
  </entry>
  
  <entry>
    
    <title type="html"><![CDATA[OSPF: краткий конспект]]></title>
    <link href="http://kozl.github.io/blog/2015/05/18/ospf-kratkii-konspiekt/"/>
    
    <updated>2015-05-18T09:38:15+03:00</updated>
    <id>http://kozl.github.io/blog/2015/05/18/ospf-kratkii-konspiekt</id>
    
    <content type="html"><![CDATA[<p>OSPF - динамический протокол маршрутизации состояния канала. Предназначен для обмена маршрутной информацией в пределах автономной системы. Исползьзуется поверх протокола IP. Маршрутизаторы обмениваются друг с другом информацией о своих интерфейсах, формируют граф сети, идентичный для каждого маршрутизатора и, используя алгоритм поиска кратчайшего пути, получают маршруты для каждой подсети.</p>

<h2 id="ospf">Терминология OSPF</h2>

<ul>
  <li><strong>Router id</strong> - уникальный в пределах домена OSPF идентификатор маршрутизатора</li>
  <li><strong>Area</strong> - совокупность маршрутизаторов, имеющих единую базу состояния каналов (LSDB). Существуют различные типы зон, вот некоторые из них:
    <ul>
      <li><strong>Backbone area</strong> - зона с идентификатором 0.0.0.0, не может быть тупиковой.</li>
      <li><strong>Stub area</strong> - зона, в которой запрещено распространение External LSA, вместо этого распространяется Summary LSA с маршрутом по умолчанию.</li>
      <li><strong>Totally stub area</strong> - Stub зона, в которой кроме того запрещено распространение Summary LSA, вместо этого распространяется единственный Summary LSA с маршрутом по умолчанию.</li>
      <li><strong>NSSArea</strong> - Stub зона, в которой разрешено распространение Type 7 External LSA, которые предназначены для анонса внешних по отношению к автономной системе маршрутов.</li>
    </ul>
  </li>
  <li><strong>LSDB</strong> - база данных, содержащая информацию о состоянии всех каналов, формируется путём обмена сообщениями LSA.</li>
  <li><strong>LSA</strong> - сообщение, описывающее состояние канала или сети. Существуют LSA разных типов, вот некоторые из них:
    <ul>
      <li><strong>Router LSA (Type 1)</strong> - объявление о состоянии каналов маршрутизатора, распространяется внутри зоны, отправляется всеми роутерами.</li>
      <li><strong>Network LSA (Type 2)</strong> - объявление о состоянии каналов сети, распространяется внутри зоны, отправляется DR.</li>
      <li><strong>Network Summary LSA (Type 3)</strong> - суммарное объявление о состоянии каналов в сети, не содержит информации о топологии сети, содержит маршруты и метрики к сетям вне зоны, распространяется ABR.</li>
      <li><strong>ASBR Summary LSA (Type 4)</strong> - суммарное объявление о состоянии каналов пограничного маршрутизатора автономной системы, распространяется ABR, то же что LSA 3, только распространяется информация о состоянии каналов ASBR.</li>
      <li><strong>AS External LSA (Type 5)</strong> - объявление о состоянии внешних каналов автономной системы, рапространяется в пределах всей автономной системы, отправялется ASBR.</li>
      <li><strong>AS External LSA for NSSA (Type 7)</strong> - объявление о состоянии внешних каналов автономной системы в NSSA зоне, аналогично LSA Type 5, рапространяется только в пределах NSSA зоны, отправялется ASBR.</li>
    </ul>
  </li>
</ul>

<h4 id="ospf-1">Типы маршрутизаторов OSPF</h4>

<ul>
  <li><strong>Backbone router</strong> - один из интерфейсов относится к магистральной зоне</li>
  <li><strong>Internal router</strong> - все интерфейсы маршрутизатора находятся в одной зоне</li>
  <li><strong>Area Border Router</strong> - соединяет одно или больше зон с магистральной зоной, для каждой зоны имеет отдельную базу состояний каналов</li>
  <li><strong>AS Boundary Router</strong> - пограничный маршрутизатор автономной системы, один из интерфейсов связан с другой автономной системой или доменом маршрутизации другого протокола</li>
</ul>

<h4 id="ospf-2">Типы пакетов OSPF</h4>

<ul>
  <li><strong>Database Description</strong> - описание всех LSA, хранящихся в LSDB маршрутизатора</li>
  <li><strong>Link State Request</strong> - запрос с описанием тех LSA, которых не хватает в LSDB</li>
  <li><strong>Link State Update</strong> - сообщение, в котором передаются полные LSA</li>
  <li><strong>Link State Acknowledgment</strong> - подтверждение о получении конкретных LSA с их описанием</li>
</ul>

<h2 id="section">Стадии обмена маршрутной информацией</h2>

<ol>
  <li>Установление отношений смежности</li>
  <li>Обмен информацией о состоянии каналов</li>
  <li>Вычисление кратчайших путей по алгоритму SPF до всех подсетей</li>
</ol>

<h4 id="section-1">Установление отношений смежности</h4>
<p>Есть отношения соседства и отношения смежности. LSA передаются только между маршрутизаторами установившими отношения смежности. Отношения смежности устанавливаются путём передачи Hello пакетов, которые также выполняют роль keepalive пакетов. Для установления смежности необходимо, чтобы на обоих маршрутизаторах совпадали следующие параметры:</p>

<ul>
  <li>Hello interval</li>
  <li>Router Dead Interval = 4 * Hello interval</li>
  <li>Area ID</li>
  <li>Authentication</li>
  <li>Stub area flag</li>
  <li>сеть и маска сети на интерфейсах</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>[Настройка таймеров OSPF на интерфейсе] </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class=""><span class="line">interface type number
</span><span class="line">ip ospf hello-interval seconds
</span><span class="line">ip ospf dead-interval seconds
</span><span class="line">ip ospf authentication-key key # plaintext
</span><span class="line">ip ospf message-digest-key key-id md5 key # md5</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>В point-to-point соединениях сразу устанавливаются отношения смежности. В сетях с широковещанием происходят выборы DR и BDR, остальные маршрутизаторы устанавливают с ними отношения смежности, а друг с другом - отношения соседства.</p>

<p>Отношения соседства происходят следующим образом:</p>

<ol>
  <li>Маршрутизатор R1 отправляет Hello сообщение на мультикастовый адрес 224.0.0.5.Маршрутизатор R2 принимает его, и если соответствующие параметры совпадают вносит его в список соседей.</li>
  <li>R2 юникастом отправляет также Hello сообщение, в котором в списке соседей уже указан R1, т.е. он его уже считает своим соседом.
R1 принимает сообщение, находит себя в списке соседей, также вносит R2 в список соседей, между ними устанавливаются отношения смежности. R1 и R2 переходят в состояние <strong>TWO WAY</strong></li>
  <li>Далее происходит обмен информацией о состоянии каналов.</li>
</ol>

<h4 id="section-2">Обмен информацией о состоянии каналов</h4>

<ol>
  <li>Маршрутизаторы обмениваются DBD сообщениями с описанием LSDB. Первым DBD отправляет маршрутизатор с большим Router ID.</li>
  <li>Подтвердив получение DBD сообщениями LSAck, R1 и R2 посылают друг другу LSR с указанием тех LSA, которые им незвестны, переходя в состояние <strong>LOADING</strong></li>
  <li>Получив LSR, маршрутизатор отправляет LSU, которые содержат в себе LSA с детальной информацией о подсетях.</li>
</ol>

<h4 id="ospf-3">Состояния узлов OSPF</h4>

<ul>
  <li><strong>Down</strong> - процесс OSPF запущен, но ни одно Hello сообщение не отправлялось. Например в случае когда мы запустили OSPF, но все интерфейсы в состоянии passive</li>
  <li><strong>Init</strong> - процесс OSPF отправил Hello сообщение и ждет ответа.</li>
  <li><strong>Two way</strong> - отношение соседства установлено, т.е. совпали все параметры Hello сообщений и маршрутизатор увидел себя в списке соседей пришедшего Hello сообщения. Такое состояние принимают DROTHER маршрутизаторы между собой в широковещательной сети.</li>
  <li><strong>Exstart</strong> - определяется Master и Slave в паре, на основании Router ID, у кого больше, тот становится Master</li>
  <li><strong>Exchange</strong> - обмен DBD сообщениями</li>
  <li><strong>Loading</strong> - во время обмена LSA, в случае если в DBD соседа есть сети, которых нет у маршрутизатора.</li>
  <li><strong>Full</strong> - когда LSDB на двух маршрутизаторах синхронизирована.</li>
</ul>
]]></content>
    
  </entry>
  
</feed>